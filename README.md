# Stock Service

## Общая информация

Stock Service — это высокопроизводительный промежуточный сервис, предназначенный для эффективного управления высокими нагрузками и взаимодействия между клиентскими приложениями и внешними сервисами. Система состоит из двух основных компонентов: **Gateway App** и **Task Service**, которые эффективно взаимодействуют для обеспечения надежной обработки запросов и обмена данными в реальном времени.

## Компоненты

### Gateway App

**Gateway App** выполняет функции маршрутизации и управления запросами, а также обеспечивает актуализацию данных и коммуникацию в реальном времени. Основные задачи включают:

- **Веб-сервер (Uvicorn с FastAPI):** Обрабатывает входящие HTTP-запросы и предоставляет API для взаимодействия с другими частями системы. Поддерживает WebSocket для двустороннего общения, позволяя клиентам получать обновления без необходимости повторных запросов.
- **Актуализатор данных:** Асинхронная задача, которая периодически проверяет данные в Redis и обновляет фронтенд, поддерживая актуальность показателей и предоставляя своевременную информацию пользователям.
- **RabbitMQ Consumer:** Получает сообщения из RabbitMQ, распределяет их между пользователями и обеспечивает быструю доставку данных в реальном времени. Это ключевой компонент для обработки и доставки сообщений и результатов задач.

### Task Service

**Task Service** предназначен для выполнения фоновых задач и распределенных вычислений. Он включает в себя:

- **Celery Worker:** Обрабатывает задачи, поставленные в очередь, выполняя длительные или ресурсоемкие операции асинхронно. Основные задачи включают агрегацию данных по запросам клиентов и периодическое обновление показателей.
- **Celery Beat:** Периодически запускает задачи по установленному расписанию, собирая данные из сторонних сервисов и выполняя регулярные обновления.
- **RabbitMQ:** Система управления очередями задач, которая распределяет их между воркерами и отправляет уведомления в Gateway App, обеспечивая гибкость и эффективность обработки запросов.
- **Redis:** Хранит актуальные данные и результаты выполнения задач, обеспечивая быстрый доступ к данным и их обновление в реальном времени.
- **Postgres:** Хранит структурированную информацию, включая метаданные и критически важные данные, необходимые для работы приложения.

## Основные функции

- **Маршрутизация запросов:** Gateway App получает запросы от клиентских приложений и перенаправляет их в Task Service через очереди сообщений, обеспечивая надежное и масштабируемое взаимодействие.
- **Обработка задач:** Task Service управляет выполнением фоновых задач, таких как агрегация данных и периодическое обновление показателей, обеспечивая быструю и эффективную обработку запросов.
- **Управление данными:** Gateway App читает и обновляет актуальные данные в Redis, предоставляя их фронтенду для поддержания синхронизации данных и актуальности информации.
- **Доставка сообщений:** Gateway App доставляет сообщения и результаты задач непосредственно пользователям, обеспечивая быструю и надежную обратную связь.

## Технологии

- **Redis:** Хранение и управление данными в реальном времени.
- **Celery:** Инструмент для обработки фоновых задач и планирования периодических задач.
- **RabbitMQ:** Обеспечивает надежное распределение задач и сообщений.
- **Postgres:** Хранение структурированной информации.

## Преимущества

- **Масштабируемость:** Архитектура позволяет легко масштабировать систему для обработки больших объемов данных и запросов.
- **Производительность:** Оптимизирована для высокой производительности при работе с большими объемами данных и высоким количеством запросов.
- **Надежность:** Использование очередей сообщений и Redis обеспечивает надежное и эффективное управление данными и задачами.

## Docker Compose Configuration

В файле `docker-compose.yml` конфигурируются следующие сервисы:

- **gateway_app:** Сервис маршрутизации и управления запросами.
- **celery_worker:** Обрабатывает фоновые задачи.
- **celery_beat:** Периодически запускает задачи по расписанию.
- **redis:** Хранит данные в реальном времени.
- **rabbitmq:** Управляет очередями сообщений.
- **postgres:** Хранит структурированную информацию.
- **web_app:** Интерфейс для взаимодействия с клиентами.

Эта конфигурация обеспечивает правильное развертывание и взаимодействие всех компонентов системы.


URL для доступа: После запуска приложения, интерфейс будет доступен по адресу http://localhost:8080.

##### Переменные окружения для доступа к внешним сервисам:
- API_KEY - для доступа к сервису polygon.io, файл конфигурации src/task_service/app/settings.py или .env файл в той же директори.


Переменные так же можно установить в файлах Dockerfile, docker-compose.yml

### Запуск проекта с Docker Compose

### Шаги для запуска

1. **Убедитесь, что Docker и Docker Compose установлены на вашем компьютере.**
   - [Скачать Docker](https://docs.docker.com/get-docker/)
   - [Скачать Docker Compose](https://docs.docker.com/compose/install/)

2. **Клонируйте репозиторий проекта (если еще не сделано):**

   ```bash
   git clone https://github.com/pythonist1/stock_service.git

3. **Запустите Docker Compose для создания и запуска контейнеров:**

    ```bash
   docker-compose up --build